---
swagger: "2.0"
info:
  version: "0.1.0"
  title: "Shipit Dashboard"
paths:

  /analysis:
    get:
      operationId: "shipit_dashboard.api.list_analysis"
      responses:
        200:
          description: An array of Analysis
          schema:
            type: array
            items:
              $ref: '#/definitions/Analysis'

  /analysis/{analysis_id}:
    get:
      operationId: "shipit_dashboard.api.get_analysis"
      parameters:
      - name: analysis_id
        in: path
        description: ID of the Analysis to retrieve
        required: true
        type: integer
      responses:
        200:
          description: A specific analysis

  /bugzilla/auth:
    get:
      operationId: "shipit_dashboard.api.get_bugzilla_auth"
      responses:
        200:
          description: Check Bugzilla credentials status
          schema:
            $ref: '#/definitions/BugzillaAuth'

    post:
      operationId: "shipit_dashboard.api.update_bugzilla_auth"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: body
          in: body
          schema:
            $ref: '#/definitions/BugzillaCredentials'
      responses:
        200:
          description: Update Bugzilla credentials
          schema:
            $ref: '#/definitions/BugzillaAuth'


definitions:

  Success:
    type: string 

  Error:
    type: object
    required:
      - error_title
    properties:
      error_title:
        type: string
      error_message:
        type: string

  Analysis:
    type: object
    required:
      - id
      - name
      - count
    properties:
      id:
        type: integer
      name:
        type: string
      count:
        type: integer
      bugs:
        type: array
        items:
          $ref: '#/definitions/Bug'

  Bug:
    type: object
    required:
      - id
      - bugzilla_id
      - summary
      - keywords
      - flags_status
      - changes_size
      - creator
      - assignee
      - reviewers
    properties:
      id:
        type: integer
      bugzilla_id:
        type: integer 
      summary:
        type: string
      keywords:
        type: array 
        items:
          type: string
      flags_status:
        type: object
        additionalProperties:
          type: string
      changes_size:
        type: integer
      creator:
        $ref: '#/definitions/Contributor'
      assignee:
        $ref: '#/definitions/Contributor'
      reviewers:
        type: array
        items:
          $ref: '#/definitions/Contributor'
      uplift:
        $ref: '#/definitions/UpliftRequest'

  Contributor:
    type: object
    required:
      - email
      - real_name
    properties:
      email:
        type: string
      real_name:
        type: string

  UpliftRequest:
    type: object
    required:
      - id
      - author
      - comment
    properties:
      id: 
        type: integer
      author:
        $ref: '#/definitions/Contributor'
      comment:
        type: string

  BugzillaAuth:
    type: object
    required:
      - authenticated
      - message
    properties:
      authenticated:
        type: boolean
      message:
        type: string

  BugzillaCredentials:
    type: object
    properties:
      login:
        type: string 
      token:
        type: string
